HOME := env_var('HOME')

set shell := ["bash", "-uc"]

default:
    just --choose

{% if yadm.class == "personal" %}
EMACSDIR := env_var('EMACSDIR')
doom_rebuild:
    # https://github.com/millejoh/emacs-ipython-notebook/issues/824
    doom clean
    fd -g '*.elc' {{ EMACSDIR }} -uuu -x rm
    doom build

doom_tangle_config:
    emacs --batch -Q --eval "(require 'org)" --eval '(org-babel-tangle-file "'$DOOMDIR'/config.org")'

mutagen_project_start:
    mutagen project start -f ~/dev/ml-west.yml

mutagen_project_terminate:
    mutagen project terminate -f ~/dev/ml-west.yml
{% endif %}


{% if yadm.class == "gcp" %}
jupyter_start:
    cd ~/dev/devr/py/nbs && tmux new-session -d -s jupyter jupyter notebook
{% endif %}


# Only capture manually installed "leaves"
brew_dump_leaves:
    #!/usr/bin/env zsh
    set -euxo pipefail
    { brew leaves --installed-on-request; echo "^tap" } | rg --file - <(brew bundle dump --describe --file=-) --before-context 1 --no-line-number --no-context-separator --word-regexp --color=never

pipx_dump:
    pipx list --json

yadm_checkpoint:
    cd {{ HOME  }} && yadm add -u && yadm ci -m "checkpoint" && yadm push


poetry_install_ipykernel:
    #!/usr/bin/env bash
    set -euxo pipefail
    cd {{ invocation_directory() }}
    if [[ $POETRY_ACTIVE -ne 1 ]]; then
        echo "Poetry is not active"
        exit 1
    fi
    poetry add -D ipykernel
    poetry install
    python -m ipykernel install --user --name=$(basename $(pwd))

# Local Variables:
# mode: just
# firestarter-mode: t
# firestarter: "yadm alt"
# End:
