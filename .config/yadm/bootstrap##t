#!/usr/bin/env -S just --justfile
# WARNING: Do not edit this file

set shell := ["bash", "-uc"]
set positional-arguments

default:
    just --list -u -f {{ justfile() }}

prezto:
    git clone --recursive https://github.com/sorin-ionescu/prezto.git "${HOME}/.zprezto"
    git clone --recurse-submodules https://github.com/belak/prezto-contrib "${HOME}/.zprezto/contrib"
    cd ~/.zprezto/contrib && git pull

brew_bundle:
    [ -f ~/.Brewfile ] && { brew bundle --global check || brew bundle --global install -v; }

pipx:
    pipx install-all ~/.pipx.json

zsh_login_shell:
    sudo apt-get install --no-install-recommends -y zsh
    sudo chsh -s $(which zsh) $(whoami)

{% if yadm.class == "debian" %}
git-credential-manager:
    cd /tmp && eget -a '.deb' GitCredentialManager/git-credential-manager && sudo dpkg -i /tmp/gcm*.deb && git credential-manager configure
{% endif %}

atuin_install:
    atuin register -u indigoviolet -e indigoviolet@gmail.com
    # atuin import auto
    atuin sync

atuin_login:
    # password from bitwarden
    atuin login -u indigoviolet --key $(cat ~/.local/share/atuin/key) -p fondness-agent-provable
    # atuin import auto
    atuin sync

git_info:
    mkdir -p ~/.local/bin && curl -fsSL https://raw.githubusercontent.com/gitbits/git-info/master/git-info --output ~/.local/bin/git-info && chmod +x ~/.local/bin/git-info

chemacs:
    git clone https://github.com/plexus/chemacs.git "${HOME}/.local/chemacs" && $HOME/.local/chemacs/install.sh

doom_emacs:
    git clone https://github.com/hlissner/doom-emacs "${HOME}/.emacs.d" && $HOME/.emacs.d/bin/doom install

{% if yadm.distro == "Ubuntu" %}
_tailscale:
    curl -fsSL https://pkgs.tailscale.com/unstable/ubuntu/jammy.noarmor.gpg | sudo tee /usr/share/keyrings/tailscale-archive-keyring.gpg >/dev/null
    curl -fsSL https://pkgs.tailscale.com/unstable/ubuntu/jammy.tailscale-keyring.list | sudo tee /etc/apt/sources.list.d/tailscale.list
    sudo apt-get update
    sudo apt-get install -y tailscale

tailscale:
    command -v tailscale || just -f {{ justfile() }} _tailscale
{% endif %}

leechblock:
    mkdir -p $HOME/dev && cd $HOME/dev && gh repo clone indigoviolet/LeechBlockNG-chrome && cd LeechBlockNG-chrome && ./install-jquery.sh

paywall:
    mkdir -p $HOME/dev && cd $HOME/dev && gh repo clone iamadamdev/bypass-paywalls-chrome

{% if yadm.distro == "Ubuntu" %}
_gcloud:
    sudo apt-get install apt-transport-https ca-certificates gnupg
    echo "deb [signed-by=/usr/share/keyrings/cloud.google.gpg] https://packages.cloud.google.com/apt cloud-sdk main" | sudo tee /etc/apt/sources.list.d/google-cloud-sdk.list
    curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key --keyring /usr/share/keyrings/cloud.google.gpg add -
    sudo apt-get update && sudo apt-get install --no-install-recommends -y google-cloud-sdk

gcloud:
    command -v gcloud || {{ just }} _gcloud
{% endif %}

{% if yadm.distro == "Ubuntu" %}
add_matebook_ppas:
    # https://github.com/qu1x/huawei-wmi/tree/master/debian#repository
    echo "deb https://deb.qu1x.org buster main" | sudo tee /etc/apt/sources.list.d/qu1x.list
    # sudo apt-key adv --keyserver hkp://pool.sks-keyservers.net --recv-keys 4503d1ab

    # matebook-applet
    echo "deb [signed-by=/usr/share/keyrings/matebook-applet.key] http://evgenykuznetsov.org/repo/ stable main" | sudo tee /etc/apt/sources.list.d/matebook-applet.list
    wget -qO - https://raw.githubusercontent.com/nekr0z/matebook-applet/master/matebook-applet.key | sudo tee /usr/share/keyrings/matebook-applet.key
{% endif %}

{% if yadm.distro == "Ubuntu" %}
nerd_fonts:
    #!/usr/bin/env bash --init-file ${HOME}/.bashrc
    set_init
    # Jetbrains Mono patched (https://github.com/ryanoasis/nerd-fonts#option-5-clone-the-repo)
    if [[ ! -d  $HOME/dev/nerd-fonts ]]; then
        mkdir -p $HOME/dev
        cd $HOME/dev
        git clone --filter=blob:none --sparse git@github.com:ryanoasis/nerd-fonts
    else
        cd $HOME/dev/nerd-fonts
        git fetch
    fi

    for font in JetBrainsMono/Ligatures IBMPlexMono VictorMono Iosevka; do
        git sparse-checkout add patched-fonts/$font
        ./install.sh "${font%%/*}"
    done
{% endif %}

doom_all_the_icons:
    # Should we do this via doomscript? https://github.com/doomemacs/doomemacs/issues/6494
    echo 'y' | emacs -l ~/.config/doom/init.el --batch -f all-the-icons-install-fonts

{% if yadm.distro == "Ubuntu" %}
twemoji_fonts:
    sudo apt-add-repository -y -S "deb https://ppa.launchpadcontent.net/eosrei/fonts/ubuntu/ impish main"
    sudo apt-get update
    sudo apt-get install -y fonts-twemoji-svginot
{% endif %}

# Local Variables:
# mode: just
# End:
